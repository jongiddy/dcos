#!/bin/bash
source /opt/mesosphere/environment.export
export LIB_INSTALL_DIR="$PKG_PATH/lib/python3.5/site-packages"
mkdir -p "$LIB_INSTALL_DIR"

pip3 install --no-deps --install-option="--prefix=$PKG_PATH" --root=/ /pkg/src/$PKG_NAME

# point to system CA bundle
for bundle in "/etc/ssl/certs/ca-certificates.crt" "/etc/pki/tls/certs/ca-bundle.crt"
do
    if [ -r "$bundle" ]
    then
        paths=$(find $PKG_PATH -name cacert.pem)
        for path in $paths
        do
            rm "$path"
            ln -s "$bundle" "$path"
        done
    fi
done
