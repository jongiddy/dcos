#!/bin/bash
source /opt/mesosphere/environment.export
export LIB_INSTALL_DIR="$PKG_PATH/lib/python3.5/site-packages"
mkdir -p "$LIB_INSTALL_DIR"

for package in futures jmespath botocore boto3 s3transfer; do
  pip3 install --no-deps --no-index --target="$LIB_INSTALL_DIR" /pkg/src/$package/*.whl
done

cfn_signal="$PKG_PATH/bin/cfn-signal"
mkdir -p $(dirname "$cfn_signal")
cp /pkg/extra/cfn-signal "$cfn_signal"

# point to system CA bundle
if [ -r "/etc/pki/tls/certs/ca-bundle.crt" ]
then
    paths=$(find $PKG_PATH -name cacert.pem)
    for path in $paths
    do
        rm "$path"
        ln -s "/etc/pki/tls/certs/ca-bundle.crt" "$path"
    done
fi
